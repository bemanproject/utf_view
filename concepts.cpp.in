module;

#include <concepts>
#include <iterator>
#include <ranges>
#include <type_traits>

export module p2728:concepts;

import null_term;

namespace p2728 {

  using namespace std;

  template <class T>
    concept @*code-unit*@ = same_as<T, char8_t> || same_as<T, char16_t> ||
                        same_as<T, char32_t>
#ifdef WCHAR_T_IS_CODE_UNIT
                        || same_as<T, wchar_t>
#ifdef CHAR_IS_CODE_UNIT
                        || same_as<T, char>
#endif
#endif
        ;

  template<class T>
    concept @*utf-iter*@ = input_iterator<T> && @*code-unit*@<iter_value_t<T>>;
#ifdef CHARN_T_POINTERS_ARE_RANGE_LIKE
  template<class T>
    concept @*utf-pointer*@ = is_pointer_v<T> && @*code-unit*@<iter_value_t<T>>;
#endif
  template<class T>
    concept @*utf-range*@ = ranges::input_range<T> && @*code-unit*@<iter_value_t<T>>;

#ifdef CHARN_T_POINTERS_ARE_RANGE_LIKE
  template<class T>
    concept @*utf-range-like*@ =
      @*utf-range*@<remove_reference_t<T>> || @*utf-pointer*@<remove_reference_t<T>>;
#endif

} // namespace p2728
